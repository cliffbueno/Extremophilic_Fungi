Stress = stress_genes_sorted$Stress)
table(stress_genes_sorted$Stress)
ann_colors <- list(Environment = c("Acid mine drainage" = hue_pal()(9)[1],
"Cryosphere - soil" = hue_pal()(9)[2],
"Cryosphere - water" = hue_pal()(9)[3],
"Desert" = hue_pal()(9)[4],
"Glacial forefield" = hue_pal()(9)[5],
"Hot spring" = hue_pal()(9)[6],
"Hydrothermal vent" = hue_pal()(9)[7],
"Hypersaline" = hue_pal()(9)[8],
"Soda lake" = hue_pal()(9)[9]),
Stress = c("Alkaline pH" = viridis_pal()(17)[1],
"Cellular" = viridis_pal()(17)[2],
"Chlorine" = viridis_pal()(17)[3],
"Cold" = viridis_pal()(17)[4],
"Environmental" = viridis_pal()(17)[5],
"Environmental-Oxidative" = viridis_pal()(17)[6],
"General" = viridis_pal()(17)[7],
"Granule" = viridis_pal()(17)[8],
"Heat" = viridis_pal()(17)[9],
"Heat-Osmotic" = viridis_pal()(17)[10],
"High pH" = viridis_pal()(17)[11],
"Metal resistance-Zn" = viridis_pal()(17)[12],
"Osmotic" = viridis_pal()(17)[13],
"Osmotic, Low pH" = viridis_pal()(17)[14],
"Oxidative" = viridis_pal()(17)[15],
"pH" = viridis_pal()(17)[16],
"Starvation" = viridis_pal()(17)[17]))
phm1 <- pheatmap(gene_hm,
color = colorRampPalette(rev(brewer.pal(n = 7, name = "RdBu")))(100),
border_color = NA,
scale = "row",
show_colnames = F,
cluster_rows = F,
cluster_cols = F,
fontsize_row = 4,
annotation_col = ann_cols,
annotation_colors = ann_colors)
phm1 <- pheatmap(gene_hm,
color = colorRampPalette(rev(brewer.pal(n = 7, name = "RdBu")))(100),
border_color = NA,
scale = "row",
show_colnames = F,
cluster_rows = F,
cluster_cols = F,
fontsize_row = 4,
annotation_col = ann_cols,
annotation_row = ann_rows,
annotation_colors = ann_colors)
ann_cols <- data.frame(row.names = colnames(gene_hm),
Environment = ko_meta_sorted$Environment)
ann_rows <- data.frame(row.names = rownames(gene_hm),
Stress = stress_genes_sorted$Stress)
ann_colors <- list(Environment = c("Acid mine drainage" = hue_pal()(9)[1],
"Cryosphere - soil" = hue_pal()(9)[2],
"Cryosphere - water" = hue_pal()(9)[3],
"Desert" = hue_pal()(9)[4],
"Glacial forefield" = hue_pal()(9)[5],
"Hot spring" = hue_pal()(9)[6],
"Hydrothermal vent" = hue_pal()(9)[7],
"Hypersaline" = hue_pal()(9)[8],
"Soda lake" = hue_pal()(9)[9]),
Stress = c("Alkaline pH" = viridis_pal()(17)[1],
"Cellular" = viridis_pal()(17)[2],
"Chlorine" = viridis_pal()(17)[3],
"Cold" = viridis_pal()(17)[4],
"Environmental" = viridis_pal()(17)[5],
"Environmental-Oxidative" = viridis_pal()(17)[6],
"General" = viridis_pal()(17)[7],
"Granule" = viridis_pal()(17)[8],
"Heat" = viridis_pal()(17)[9],
"Heat-Osmotic" = viridis_pal()(17)[10],
"High pH" = viridis_pal()(17)[11],
"Metal resistance-Zn" = viridis_pal()(17)[12],
"Osmotic" = viridis_pal()(17)[13],
"Osmotic, Low pH" = viridis_pal()(17)[14],
"Oxidative" = viridis_pal()(17)[15],
"pH" = viridis_pal()(17)[16],
"Starvation" = viridis_pal()(17)[17]))
phm1 <- pheatmap(gene_hm,
color = colorRampPalette(rev(brewer.pal(n = 7, name = "RdBu")))(100),
border_color = NA,
scale = "row",
show_colnames = F,
cluster_rows = F,
cluster_cols = F,
fontsize_row = 4,
annotation_col = ann_cols,
annotation_row = ann_rows,
annotation_colors = ann_colors)
phm1 <- pheatmap(gene_hm,
color = colorRampPalette(rev(brewer.pal(n = 7, name = "RdBu")))(100),
border_color = NA,
scale = "row",
show_colnames = F,
angle_col = 315,
cluster_rows = F,
cluster_cols = F,
fontsize_row = 4,
annotation_col = ann_cols,
annotation_row = ann_rows,
annotation_colors = ann_colors)
View(gene_plot_summary)
# Still no good. Summarize by environment so there are only 9 columns
gene_plot_sorted <- ko_comm_DESeq_sorted %>%
dplyr::select(stress_genes_sorted$KO) %>%
mutate("Environment" = ko_meta_sorted$Environment)
gene_plot_long_sorted <- gene_plot_sorted %>%
pivot_longer(names(gene_plot)[1:157],
names_to = "Gene", values_to = "Abundance") %>%
mutate(Environment = dplyr::recode_factor(Environment,
"Acid mine drainage" = "Acid mine drainage (n = 33)",
"Cryosphere" = "Cryosphere (n = 47)",
"Desert" = "Desert (n = 33)",
"Glacial forefield" = "Glacial forefield (n = 60)",
"Hot spring" = "Hot spring (n = 167)",
"Hydrothermal vent" = "Hydrothermal vent (n = 237)",
"Hypersaline" = "Hypersaline (n = 225)",
"Soda lake" = "Soda lake (n = 25)"))
gene_plot_summary_sorted <- gene_plot_long_sorted %>%
group_by(Environment, Gene) %>%
summarise(mean = mean(Abundance),
se = std.error(Abundance))
View(gene_plot_summary_sorted)
gene_hm_summary <- gene_plot_summary_sorted %>%
dplyr::select(-se) %>%
pivot_wider(names_from = Environment, values_from = mean)
View(gene_hm_summary)
View(gene_hm)
gene_hm_summary <- gene_plot_summary_sorted %>%
dplyr::select(-se) %>%
pivot_wider(names_from = Environment, values_from = mean) %>%
column_to_rownames(var = "Gene") %>%
as.matrix()
gene_hm_summary <- gene_plot_summary_sorted %>%
dplyr::select(-se) %>%
pivot_wider(names_from = Environment, values_from = mean) %>%
column_to_rownames(var = "Gene") %>%
t() %>%
dplyr::select(stress_genes_sorted$KO) %>%
t() %>%
as.matrix()
gene_hm_summary <- gene_plot_summary_sorted %>%
dplyr::select(-se) %>%
pivot_wider(names_from = Environment, values_from = mean) %>%
column_to_rownames(var = "Gene") %>%
t() %>%
as.data.frame() %>%
dplyr::select(stress_genes_sorted$KO) %>%
t() %>%
as.matrix()
ann_rows <- data.frame(row.names = rownames(gene_hm),
Stress = stress_genes_sorted$Stress)
ann_colors <- list(Stress = c("Alkaline pH" = viridis_pal()(17)[1],
"Cellular" = viridis_pal()(17)[2],
"Chlorine" = viridis_pal()(17)[3],
"Cold" = viridis_pal()(17)[4],
"Environmental" = viridis_pal()(17)[5],
"Environmental-Oxidative" = viridis_pal()(17)[6],
"General" = viridis_pal()(17)[7],
"Granule" = viridis_pal()(17)[8],
"Heat" = viridis_pal()(17)[9],
"Heat-Osmotic" = viridis_pal()(17)[10],
"High pH" = viridis_pal()(17)[11],
"Metal resistance-Zn" = viridis_pal()(17)[12],
"Osmotic" = viridis_pal()(17)[13],
"Osmotic, Low pH" = viridis_pal()(17)[14],
"Oxidative" = viridis_pal()(17)[15],
"pH" = viridis_pal()(17)[16],
"Starvation" = viridis_pal()(17)[17]))
ann_rows <- data.frame(row.names = rownames(gene_hm_summary),
Stress = stress_genes_sorted$Stress)
ann_colors <- list(Stress = c("Alkaline pH" = viridis_pal()(17)[1],
"Cellular" = viridis_pal()(17)[2],
"Chlorine" = viridis_pal()(17)[3],
"Cold" = viridis_pal()(17)[4],
"Environmental" = viridis_pal()(17)[5],
"Environmental-Oxidative" = viridis_pal()(17)[6],
"General" = viridis_pal()(17)[7],
"Granule" = viridis_pal()(17)[8],
"Heat" = viridis_pal()(17)[9],
"Heat-Osmotic" = viridis_pal()(17)[10],
"High pH" = viridis_pal()(17)[11],
"Metal resistance-Zn" = viridis_pal()(17)[12],
"Osmotic" = viridis_pal()(17)[13],
"Osmotic, Low pH" = viridis_pal()(17)[14],
"Oxidative" = viridis_pal()(17)[15],
"pH" = viridis_pal()(17)[16],
"Starvation" = viridis_pal()(17)[17]))
phm1 <- pheatmap(gene_hm_summary,
color = colorRampPalette(rev(brewer.pal(n = 7, name = "RdBu")))(100),
border_color = NA,
scale = "row",
show_colnames = F,
angle_col = 315,
cluster_rows = F,
cluster_cols = F,
fontsize_row = 4,
annotation_row = ann_rows,
annotation_colors = ann_colors)
phm1 <- pheatmap(gene_hm_summary,
color = colorRampPalette(rev(brewer.pal(n = 7, name = "RdBu")))(100),
border_color = NA,
scale = "row",
show_colnames = T,
angle_col = 315,
cluster_rows = F,
cluster_cols = F,
fontsize_row = 4,
annotation_row = ann_rows,
annotation_colors = ann_colors)
phm2 <- pheatmap(gene_hm_summary,
color = colorRampPalette(rev(brewer.pal(n = 7, name = "RdBu")))(100),
border_color = NA,
scale = "row",
show_colnames = T,
angle_col = 315,
cluster_rows = T,
cluster_cols = T,
fontsize_row = 4,
annotation_row = ann_rows,
annotation_colors = ann_colors)
table(ko_meta$Environment)
# Still no good. Summarize by environment so there are only 9 columns
gene_plot_sorted <- ko_comm_DESeq_sorted %>%
dplyr::select(stress_genes_sorted$KO) %>%
mutate("Environment" = ko_meta_sorted$Environment)
gene_plot_long_sorted <- gene_plot_sorted %>%
pivot_longer(names(gene_plot)[1:157],
names_to = "Gene", values_to = "Abundance") %>%
mutate(Environment = dplyr::recode_factor(Environment,
"Acid mine drainage" = "Acid mine drainage (n = 33)",
"Cryosphere - soil" = "Cryosphere - soil (n = 27)",
"Cryosphere - water" = "Cryosphere - water (n = 20)",
"Desert" = "Desert (n = 33)",
"Glacial forefield" = "Glacial forefield (n = 60)",
"Hot spring" = "Hot spring (n = 167)",
"Hydrothermal vent" = "Hydrothermal vent (n = 237)",
"Hypersaline" = "Hypersaline (n = 225)",
"Soda lake" = "Soda lake (n = 25)"))
gene_plot_summary_sorted <- gene_plot_long_sorted %>%
group_by(Environment, Gene) %>%
summarise(mean = mean(Abundance),
se = std.error(Abundance))
gene_hm_summary <- gene_plot_summary_sorted %>%
dplyr::select(-se) %>%
pivot_wider(names_from = Environment, values_from = mean) %>%
column_to_rownames(var = "Gene") %>%
t() %>%
as.data.frame() %>%
dplyr::select(stress_genes_sorted$KO) %>%
t() %>%
as.matrix()
ann_rows <- data.frame(row.names = rownames(gene_hm_summary),
Stress = stress_genes_sorted$Stress)
ann_colors <- list(Stress = c("Alkaline pH" = viridis_pal()(17)[1],
"Cellular" = viridis_pal()(17)[2],
"Chlorine" = viridis_pal()(17)[3],
"Cold" = viridis_pal()(17)[4],
"Environmental" = viridis_pal()(17)[5],
"Environmental-Oxidative" = viridis_pal()(17)[6],
"General" = viridis_pal()(17)[7],
"Granule" = viridis_pal()(17)[8],
"Heat" = viridis_pal()(17)[9],
"Heat-Osmotic" = viridis_pal()(17)[10],
"High pH" = viridis_pal()(17)[11],
"Metal resistance-Zn" = viridis_pal()(17)[12],
"Osmotic" = viridis_pal()(17)[13],
"Osmotic, Low pH" = viridis_pal()(17)[14],
"Oxidative" = viridis_pal()(17)[15],
"pH" = viridis_pal()(17)[16],
"Starvation" = viridis_pal()(17)[17]))
phm1 <- pheatmap(gene_hm_summary,
color = colorRampPalette(rev(brewer.pal(n = 7, name = "RdBu")))(100),
border_color = NA,
scale = "row",
show_colnames = T,
angle_col = 315,
cluster_rows = F,
cluster_cols = F,
fontsize_row = 4,
annotation_row = ann_rows,
annotation_colors = ann_colors)
phm1 <- pheatmap(gene_hm_summary,
color = colorRampPalette(rev(brewer.pal(n = 7, name = "RdBu")))(100),
border_color = NA,
scale = "row",
show_colnames = T,
angle_col = 315,
cluster_rows = F,
cluster_cols = T,
fontsize_row = 4,
annotation_row = ann_rows,
annotation_colors = ann_colors)
phm2 <- pheatmap(gene_hm_summary,
color = colorRampPalette(rev(brewer.pal(n = 7, name = "RdBu")))(100),
border_color = NA,
scale = "row",
show_colnames = T,
angle_col = 315,
cluster_rows = T,
cluster_cols = T,
fontsize_row = 4,
annotation_row = ann_rows,
annotation_colors = ann_colors)
phm1 <- pheatmap(gene_hm_summary,
color = colorRampPalette(rev(brewer.pal(n = 7, name = "RdBu")))(100),
border_color = NA,
scale = "column",
show_colnames = T,
angle_col = 315,
cluster_rows = F,
cluster_cols = T,
fontsize_row = 4,
annotation_row = ann_rows,
annotation_colors = ann_colors)
phm1 <- pheatmap(gene_hm_summary,
color = colorRampPalette(rev(brewer.pal(n = 7, name = "RdBu")))(100),
border_color = NA,
scale = "none",
show_colnames = T,
angle_col = 315,
cluster_rows = F,
cluster_cols = T,
fontsize_row = 4,
annotation_row = ann_rows,
annotation_colors = ann_colors)
phm1 <- pheatmap(gene_hm_summary,
color = colorRampPalette(rev(brewer.pal(n = 7, name = "RdBu")))(100),
border_color = NA,
scale = "row",
show_colnames = T,
angle_col = 315,
cluster_rows = F,
cluster_cols = T,
fontsize_row = 4,
annotation_row = ann_rows,
annotation_colors = ann_colors)
phm2 <- pheatmap(gene_hm_summary,
color = colorRampPalette(rev(brewer.pal(n = 7, name = "RdBu")))(100),
legend = T,
legend_breaks = c(-2, -1, 0, 1, 2, 3),
legend_labels = c("-2", "-1", "0", "1", "2", "Abund.\nz-score"),
border_color = NA,
scale = "row",
show_colnames = T,
angle_col = 315,
cluster_rows = T,
cluster_cols = T,
fontsize_row = 4,
annotation_row = ann_rows,
annotation_colors = ann_colors)
phm2 <- pheatmap(gene_hm_summary,
color = colorRampPalette(rev(brewer.pal(n = 7, name = "RdBu")))(100),
legend = T,
legend_breaks = c(-2, -1, 0, 1, 2, 2.5),
legend_labels = c("-2", "-1", "0", "1", "2", "Abund.\nz-score"),
border_color = NA,
scale = "row",
show_colnames = T,
angle_col = 315,
cluster_rows = T,
cluster_cols = T,
fontsize_row = 4,
annotation_row = ann_rows,
annotation_colors = ann_colors)
phm2 <- pheatmap(gene_hm_summary,
color = colorRampPalette(rev(brewer.pal(n = 7, name = "RdBu")))(100),
legend = T,
legend_breaks = c(-2, -1, 0, 1, 2, 2.6),
legend_labels = c("-2", "-1", "0", "1", "2", "Abund.\nz-score"),
border_color = NA,
scale = "row",
show_colnames = T,
angle_col = 315,
cluster_rows = T,
cluster_cols = T,
fontsize_row = 4,
annotation_row = ann_rows,
annotation_colors = ann_colors)
phm2 <- pheatmap(gene_hm_summary,
color = colorRampPalette(rev(brewer.pal(n = 7, name = "RdBu")))(100),
legend = T,
legend_breaks = c(-2, -1, 0, 1, 2, 2.7),
legend_labels = c("-2", "-1", "0", "1", "2", "Abund.\nz-score"),
border_color = NA,
scale = "row",
show_colnames = T,
angle_col = 315,
cluster_rows = T,
cluster_cols = T,
fontsize_row = 4,
annotation_row = ann_rows,
annotation_colors = ann_colors)
phm2 <- pheatmap(gene_hm_summary,
color = colorRampPalette(rev(brewer.pal(n = 7, name = "RdBu")))(100),
legend = T,
legend_breaks = c(-2, -1, 0, 1, 2, 2.65),
legend_labels = c("-2", "-1", "0", "1", "2", "Abund.\nz-score"),
border_color = NA,
scale = "row",
show_colnames = T,
angle_col = 315,
cluster_rows = T,
cluster_cols = T,
fontsize_row = 4,
annotation_row = ann_rows,
annotation_colors = ann_colors)
phm2 <- pheatmap(gene_hm_summary,
color = colorRampPalette(rev(brewer.pal(n = 7, name = "RdBu")))(100),
legend = T,
legend_breaks = c(-2, -1, 0, 1, 2, 2.65),
legend_labels = c("-2", "-1", "0", "1", "2", "Abund."),
border_color = NA,
scale = "row",
show_colnames = T,
angle_col = 315,
cluster_rows = T,
cluster_cols = T,
fontsize_row = 4,
annotation_row = ann_rows,
annotation_colors = ann_colors)
phm2 <- pheatmap(gene_hm_summary,
color = colorRampPalette(rev(brewer.pal(n = 7, name = "RdBu")))(100),
legend = T,
legend_breaks = c(-2, -1, 0, 1, 2, 2.65),
legend_labels = c("-2", "-1", "0", "1", "2", "Abund."),
main = "",
border_color = NA,
scale = "row",
show_colnames = T,
angle_col = 315,
cluster_rows = T,
cluster_cols = T,
fontsize_row = 4,
annotation_row = ann_rows,
annotation_colors = ann_colors)
phm1 <- pheatmap(gene_hm_summary,
color = colorRampPalette(rev(brewer.pal(n = 7, name = "RdBu")))(100),
legend = T,
legend_breaks = c(-2, -1, 0, 1, 2, 2.65),
legend_labels = c("-2", "-1", "0", "1", "2", "Abund."),
border_color = NA,
scale = "row",
show_colnames = T,
angle_col = 315,
cluster_rows = F,
cluster_cols = T,
fontsize_row = 4,
annotation_row = ann_rows,
annotation_colors = ann_colors)
save_pheatmap_pdf(phm1, "FigsUpdated/KO_heatmap_Stress.pdf")
save_pheatmap_pdf <- function(x, filename, width = 7, height = 12) {
stopifnot(!missing(x))
stopifnot(!missing(filename))
pdf(filename, width=width, height=height)
grid::grid.newpage()
grid::grid.draw(x$gtable)
dev.off()
}
save_pheatmap_pdf(phm1, "FigsUpdated/KO_heatmap_Stress.pdf")
View(gene_plot_sorted)
View(gene_plot_long_sorted)
View(stress_genes_sorted)
write.csv(stress_genes_sorted, "stress_genes_sorted_5.19.23.csv")
stress_genes_sorted$KOsymb <- paste(stress_genes_sorted$KO, stress_genes_sorted$Symbol, sep = ";")
View(stress_genes_sorted)
stress_genes_sorted$KOsymb <- paste(stress_genes_sorted$KO, stress_genes_sorted$Symbol, sep = "; ")
rownames(gene_hm_summary)
rownames(gene_hm_summary) <- stress_genes_sorted$KOsymb
ann_rows <- data.frame(row.names = rownames(gene_hm_summary),
Stress = stress_genes_sorted$Stress)
ann_colors <- list(Stress = c("Alkaline pH" = viridis_pal()(17)[1],
"Cellular" = viridis_pal()(17)[2],
"Chlorine" = viridis_pal()(17)[3],
"Cold" = viridis_pal()(17)[4],
"Environmental" = viridis_pal()(17)[5],
"Environmental-Oxidative" = viridis_pal()(17)[6],
"General" = viridis_pal()(17)[7],
"Granule" = viridis_pal()(17)[8],
"Heat" = viridis_pal()(17)[9],
"Heat-Osmotic" = viridis_pal()(17)[10],
"High pH" = viridis_pal()(17)[11],
"Metal resistance-Zn" = viridis_pal()(17)[12],
"Osmotic" = viridis_pal()(17)[13],
"Osmotic, Low pH" = viridis_pal()(17)[14],
"Oxidative" = viridis_pal()(17)[15],
"pH" = viridis_pal()(17)[16],
"Starvation" = viridis_pal()(17)[17]))
phm1 <- pheatmap(gene_hm_summary,
color = colorRampPalette(rev(brewer.pal(n = 7, name = "RdBu")))(100),
legend = T,
legend_breaks = c(-2, -1, 0, 1, 2, 2.65),
legend_labels = c("-2", "-1", "0", "1", "2", "Abund."),
border_color = NA,
scale = "row",
show_colnames = T,
angle_col = 315,
cluster_rows = F,
cluster_cols = T,
fontsize_row = 4,
annotation_row = ann_rows,
annotation_colors = ann_colors)
save_pheatmap_pdf <- function(x, filename, width = 7, height = 12) {
stopifnot(!missing(x))
stopifnot(!missing(filename))
pdf(filename, width=width, height=height)
grid::grid.newpage()
grid::grid.draw(x$gtable)
dev.off()
}
save_pheatmap_pdf(phm1, "FigsUpdated/KO_heatmap_Stress.pdf")
